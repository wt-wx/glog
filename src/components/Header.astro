---
import HeaderLink from './HeaderLink.astro';
import Search from './Search.astro';
import { SITE_TITLE } from '../consts';
---

<header class="sticky top-0 z-50 glass border-b border-muted/20">
	<nav class="max-w-6xl mx-auto px-6 h-20 flex items-center justify-between gap-4">
		<div class="flex items-center gap-4 md:gap-8 flex-1 min-w-0">
			<h2 class="text-lg md:text-xl font-bold tracking-tighter shrink-0 truncate" transition:name="site-title">
				<a href="/" class="hover:text-brand transition-colors text-foreground">{SITE_TITLE}</a>
			</h2>
			<div class="hidden sm:block flex-1 max-w-xs">
				<Search uid="desktop" />
			</div>
		</div>

		<!-- Desktop Navigation -->
		<div class="hidden md:flex items-center gap-6 font-medium shrink-0">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/about">About</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/xlog">X-Log</HeaderLink>
		</div>

		<!-- Mobile Controls -->
		<div class="flex items-center gap-2 md:hidden">
			<div class="sm:hidden">
				<Search uid="mobile" />
			</div>
			<button id="mobile-menu-toggle" class="p-2 rounded-xl bg-muted/20 border border-muted/50 text-foreground" aria-label="Toggle Menu">
				<svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
				<svg id="close-icon" class="hidden" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
			</button>
		</div>
	</nav>
</header>

<!-- Mobile Menu Drawer -->
<div id="mobile-menu" class="fixed inset-x-0 top-20 bottom-0 bg-background/95 backdrop-blur-2xl z-40 hidden md:hidden flex flex-col p-6 gap-6 animate-in fade-in slide-in-from-top-4 duration-300">
	<div class="grid gap-4">
		<a href="/" class="text-2xl font-bold p-4 rounded-2xl bg-muted/20 border border-muted/50 hover:bg-brand/10 hover:border-brand/40 transition-all flex items-center justify-between">
			Home
			<span class="text-brand">→</span>
		</a>
		<a href="/about" class="text-2xl font-bold p-4 rounded-2xl bg-muted/20 border border-muted/50 hover:bg-brand/10 hover:border-brand/40 transition-all flex items-center justify-between">
			About
			<span class="text-brand">→</span>
		</a>
		<a href="/blog" class="text-2xl font-bold p-4 rounded-2xl bg-muted/20 border border-muted/50 hover:bg-brand/10 hover:border-brand/40 transition-all flex items-center justify-between">
			Blog
			<span class="text-brand">→</span>
		</a>
		<a href="/xlog" class="text-2xl font-bold p-4 rounded-2xl bg-muted/20 border border-muted/50 hover:bg-brand/10 hover:border-brand/40 transition-all flex items-center justify-between">
			X-Log
			<span class="text-brand">→</span>
		</a>
	</div>
	<div class="mt-auto p-6 rounded-3xl bg-brand/5 border border-brand/10">
		<p class="text-sm font-medium text-brand mb-1 uppercase tracking-widest">Connect</p>
		<p class="text-muted-foreground text-sm leading-relaxed">分享每日新知，沉淀知识，持续成长。</p>
	</div>
</div>

<script>
	document.addEventListener('astro:page-load', () => {
		const toggleBtn = document.getElementById('mobile-menu-toggle');
		const menu = document.getElementById('mobile-menu');
		const menuIcon = document.getElementById('menu-icon');
		const closeIcon = document.getElementById('close-icon');

		toggleBtn?.addEventListener('click', () => {
			const isHidden = menu?.classList.contains('hidden');
			if (isHidden) {
				menu?.classList.remove('hidden');
				menuIcon?.classList.add('hidden');
				closeIcon?.classList.remove('hidden');
				document.body.style.overflow = 'hidden';
			} else {
				menu?.classList.add('hidden');
				menuIcon?.classList.remove('hidden');
				closeIcon?.classList.add('hidden');
				document.body.style.overflow = '';
			}
		});

		// Close menu on navigation
		menu?.querySelectorAll('a').forEach(link => {
			link.addEventListener('click', () => {
				menu?.classList.add('hidden');
				menuIcon?.classList.remove('hidden');
				closeIcon?.classList.add('hidden');
				document.body.style.overflow = '';
			});
		});
	});
</script>
