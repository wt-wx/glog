---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import Pagination from '../components/Pagination.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getBlogPosts, getSortedBlogPosts } from '../lib/content';

export async function getStaticPaths({ paginate }) {
	const posts = await getSortedBlogPosts();
	return paginate(posts, { pageSize: 5 });
}

const { page } = Astro.props;
const posts = page.data;

// For the tag cloud in hero
const allPosts = await getBlogPosts();
const tags = [...new Set(allPosts.flatMap(post => post.data.tags))].slice(0, 5);
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body class="bg-background text-foreground antialiased transition-colors duration-300">
		<Header />
		<main class="max-w-4xl mx-auto px-6 py-20">
			{page.currentPage === 1 && (
				<section class="mb-20">
					<h1 class="text-5xl md:text-6xl font-black mb-6 tracking-tight animate-in fade-in slide-in-from-bottom-4 duration-1000">
						Daily <span class="text-brand">Thoughts</span>
					</h1>
					<p class="text-xl md:text-2xl text-muted-foreground max-w-2xl leading-relaxed opacity-80 mb-8">
						{SITE_DESCRIPTION}
					</p>
					<div class="flex flex-wrap gap-3 animate-in fade-in slide-in-from-bottom-6 duration-1000 delay-300">
						{['AI', 'Grok', 'Architecture', 'n8n', 'VPP'].map(tag => (
							<a href={`/tags/${tag.toLowerCase()}`} class="text-xs font-bold uppercase tracking-widest px-4 py-2 rounded-full border border-muted hover:border-brand hover:text-brand transition-all">
								#{tag}
							</a>
						))}
						<a href="/tags" class="text-xs font-bold uppercase tracking-widest px-4 py-2 rounded-full bg-muted/50 hover:bg-brand hover:text-white hover:opacity-100 transition-all">
							All Tags
						</a>
					</div>
				</section>
			)}

			<section>
				<div class="flex items-center justify-between mb-12">
					<h2 class="text-2xl font-bold uppercase tracking-widest text-muted-foreground/50">
						{page.currentPage === 1 ? 'Recent Posts' : `Posts - Page ${page.currentPage}`}
					</h2>
					{page.currentPage === 1 && (
						<a href="/blog" class="group flex items-center gap-2 font-medium">
							View All Archive
							<span class="group-hover:translate-x-1 transition-transform">â†’</span>
						</a>
					)}
				</div>
				
				<div class="space-y-12">
					{
						posts.map((post) => (
							<article class="group">
								<a href={`/blog/${post.id}/`} class="block space-y-2">
									<div class="flex flex-col md:flex-row md:items-baseline justify-between gap-4">
										<h3 class="text-2xl md:text-3xl font-bold group-hover:text-brand transition-colors">
											{post.data.title}
										</h3>
										<time datetime={post.data.pubDate.toISOString()} class="text-sm font-mono text-muted-foreground whitespace-nowrap">
											{post.data.pubDate.toLocaleDateString('zh-CN', {
												year: 'numeric',
												month: 'short',
												day: 'numeric',
											})}
										</time>
									</div>
									<p class="text-lg text-muted-foreground line-clamp-2 max-w-3xl">
										{post.data.description}
									</p>
									<div class="flex flex-wrap gap-2 pt-1">
										{post.data.tags.map((tag) => (
											<span class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded bg-muted text-muted-foreground group-hover:bg-brand/10 group-hover:text-brand transition-colors">
												{tag}
											</span>
										))}
									</div>
								</a>
							</article>
						))
					}
				</div>

				<Pagination page={page} />
			</section>
		</main>
		<Footer />
	</body>
</html>
